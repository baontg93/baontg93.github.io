window.__require=function e(t,i,n){function r(o,s){if(!i[o]){if(!t[o]){var c=o.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!s&&d)return d(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+o+"'")}o=c}var l=i[o]={exports:{}};t[o][0].call(l.exports,function(e){return r(t[o][1][e]||e)},l,l.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<n.length;o++)r(n[o]);return r}({"card-provider":[function(e,t){"use strict";cc._RF.push(t,"c1087ZRmRVCTb4YKDYd1I3U","card-provider");var i=["Diamond","Club","Heart","Spade"],n=cc.Class({extends:cc.Component,properties:{spriteFrames:{default:[],type:cc.SpriteFrame}},statics:{Instance:null},ctor:function(){n.Instance=this,this.dictSpriteFrame={}},onLoad:function(){for(var e=0;e<this.spriteFrames.length;e++){var t=this.spriteFrames[e];this.dictSpriteFrame[this.getKey(t.name)]=t}},getKey:function(e){return e.toLowerCase().replace(new RegExp("-","g"),"")},GetCard:function(e){if(null==e)return cc.warn("Get sprite frame with invalid id:",e),null;var t=Math.floor(e/4)+1,n=i[e%4],r=cc.js.formatStr("%s_%s",n,t<10?"0"+t:t);return this.dictSpriteFrame[this.getKey(r)]},GetCardMini:function(e){if(null==e)return cc.warn("Get sprite frame with invalid id:",e),null;var t=Math.floor(e/4)+1,n=i[e%4],r=cc.js.formatStr("%s_%s_mini",n,t<10?"0"+t:t);return this.dictSpriteFrame[this.getKey(r)]},GetCardValue:function(e){return null==e?(cc.warn("Get value with invalid id:",e),null):Math.floor(e/4)+1}});cc._RF.pop()},{}],"cc-enum":[function(e,t){"use strict";cc._RF.push(t,"697e780SF5Lt4umKItsJFp/","cc-enum"),cc.Enum=function(e){if("__enums__"in e)return e;cc.js.value(e,"__enums__",null,!0);for(var t=-1,i=Object.keys(e),n=0;n<i.length;n++){var r=i[n],a=e[r];if(-999===a)a=++t,e[r]=a;else if("number"==typeof a)t=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&cc.js.value(e,o,r)}return e},cc.Enum.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},cc.Enum.getList=function(e){if(e.__enums__)return e.__enums__;var t=e.__enums__=[];for(var i in e){var n=e[i];if(Number.isInteger(n)){var r={name:i,value:n};t.push(r)}}return t.sort(function(e,t){return e.value-t.value}),t},cc._RF.pop()},{}],"corner-peeking":[function(e,t){"use strict";cc._RF.push(t,"e98aa6os/JNA6VJlrMNJERk","corner-peeking");var i=e("peek-card-enums");cc.Class({extends:cc.Component,properties:{NodeVertex:cc.Node,NodeAreaPeeking:cc.Node,NodeAreaCorner:cc.Node,NodeAreaCancel:cc.Node,MaskAnchorHorizontal:cc.Vec2,MaskAnchorVerticle:cc.Vec2,FaceAnchor:cc.Vec2,HorizontalAlign:{default:i.HorizontalAlign.Left,type:i.HorizontalAlign},VerticalAlign:{default:i.VerticalAlign.Top,type:i.VerticalAlign}},GetCornerData:function(e,t){if(0==this.node.activeInHierarchy)return null;if(null==e||cc.Intersection.pointInPolygon(e,this.getArrPointFromNode(this.NodeAreaCorner))){var n=this.NodeVertex.parent.convertToWorldSpaceAR(this.NodeVertex.position);return{MaskAnchor:t==i.AxisDirection.Horizontal?this.MaskAnchorHorizontal:this.MaskAnchorVerticle,FaceAnchor:this.FaceAnchor,HorizontalAlign:this.HorizontalAlign,VerticalAlign:this.VerticalAlign,VertexDragging:n,ArrPointOfRectPeeking:this.getArrPointFromNode(this.NodeAreaPeeking),ArrPointOfRectCancel:this.getArrPointFromNode(this.NodeAreaCancel)}}return null},getArrPointFromNode:function(e){var t=[];if(null==e)return t;var i=e.getComponent(cc.Collider);if(null!=i)t=i.world.points;else{var n=e.getBoundingBoxToWorld();t.push(new cc.Vec2(n.x,n.y)),t.push(new cc.Vec2(n.x,n.yMax)),t.push(new cc.Vec2(n.xMax,n.yMax)),t.push(new cc.Vec2(n.xMax,n.y))}return t}}),cc._RF.pop()},{"peek-card-enums":"peek-card-enums"}],"peek-card-content":[function(e,t){"use strict";cc._RF.push(t,"0525e0A8LVHW5c1dkGr6wlf","peek-card-content");var i=e("corner-peeking"),n=e("peek-card-enums"),r=e("card-provider"),a=["Diamond","Club","Heart","Spade"];cc.Class({extends:cc.Component,properties:{AxisDirection:{default:n.AxisDirection.Vertical,type:n.AxisDirection},ArrCorner:{default:[],type:i},CornerAutoPeek:{default:null,type:i},StartPointAutoPeek:cc.Node,EndPointAutoPeek:cc.Node,Container:cc.Node,AutoPeekMovingNode:cc.Node,CornerContainer:cc.Node,NodeFaceCardDrag:cc.Node,NodeFaceCardDisplay:cc.Node,NodeBackCardDrag:cc.Node,NodeBackCardDisplay:cc.Node,NodeMaskCard:cc.Node,NodeRedBlur:cc.Node,NodeBlackBlur:cc.Node},onLoad:function(){this.nodeBlur={},cc.director.getCollisionManager().enabled=!0,this.spriteBackCard=this.NodeBackCardDrag.getComponent(cc.Sprite),this.spriteFace=this.NodeFaceCardDisplay.getComponent(cc.Sprite),this.spriteFaceDrag=this.NodeFaceCardDrag.getComponent(cc.Sprite),this.mask=this.NodeMaskCard.getComponent(cc.Mask),this.horizontalAlign=n.HorizontalAlign.Center,this.verticalAlign=n.VerticalAlign.Center,this.defaultAxis=this.AxisDirection,this.angleDragging=0,this.angleCoefficient=1,this.isOpened=!1,this.isAutoPeeking=!1,this.timelineAutoPeek=new TimelineMax,this.NodeBackCardDrag.on(cc.Node.EventType.TOUCH_START,this.handleMouseDown,this),this.reset()},register:function(){this.NodeBackCardDrag.on(cc.Node.EventType.TOUCH_END,this.handleMouseUp,this),this.NodeBackCardDrag.on(cc.Node.EventType.TOUCH_CANCEL,this.handleMouseUp,this),this.NodeBackCardDrag.on(cc.Node.EventType.TOUCH_MOVE,this.handleMouseMoved,this)},unregister:function(){this.NodeBackCardDrag.off(cc.Node.EventType.TOUCH_END,this.handleMouseUp,this),this.NodeBackCardDrag.off(cc.Node.EventType.TOUCH_CANCEL,this.handleMouseUp,this),this.NodeBackCardDrag.off(cc.Node.EventType.TOUCH_MOVE,this.handleMouseMoved,this)},OpenPeekCard:function(e){this.nodeBlur=this.getNodeBlur(e);var t=r.Instance.GetCard(e);this.spriteFace.spriteFrame=t,this.spriteFaceDrag.spriteFrame=t,this.spriteFaceDrag.enabled=!1,this.spriteBackCard.enabled=!0,this.NodeMaskCard.active=!1,this.mask.enabled=!0,this.Container.active=!0,this.isOpened=!1,this.isAutoPeeking=!1,this.timelineDisplay=new TimelineMax,this.timelineDisplay.add(TweenMax.to(this.Container,.5,{x:0})),this.timelineDisplay.addCallback(this.handleMouseUp.bind(this))},DisablePeekCard:function(){this.handleMouseUp(),this.CornerContainer.active=!1},HidePeekCard:function(){this.timelineDisplay.eventCallback("onReverseComplete",this.reset.bind(this)),this.timelineDisplay.reverse()},AutoPeek:function(){var e=this;if(e.handleMouseUp(),1!=e.isOpened){e.isAutoPeeking=!0;var t=e.getWorldPosition(e.StartPointAutoPeek),i=e.getWorldPosition(e.EndPointAutoPeek);console.log(t),e.setCornerData(e.CornerAutoPeek.GetCornerData(null,e.AxisDirection)),e.handlePointerLocation(t),e.timelineAutoPeek=new TimelineMax,e.timelineAutoPeek.add(TweenMax.to(t,.5,{x:i.x,y:i.y,onUpdate:function(){e.handlePointerLocation(t)}})),e.timelineAutoPeek.addCallback(function(){e.isAutoPeeking=!1,e.handlePointerLocation(i)})}},getNodeBlur:function(e){switch(a[e%4]){case"Diamond":case"Heart":return this.NodeRedBlur.active=!0,this.NodeBlackBlur.active=!1,this.NodeRedBlur;default:return this.NodeRedBlur.active=!1,this.NodeBlackBlur.active=!0,this.NodeBlackBlur}},showDisplayCard:function(){this.spriteFaceDrag.spriteFrame=this.spriteFace.spriteFrame,this.spriteFaceDrag.enabled=!0,this.NodeMaskCard.active=!1,this.CornerContainer.active=!1,this.nodeBlur.active=!1,this.isOpened=!0,this.unregister()},reset:function(){this.isAutoPeeking=!1,this.vertexDragging=cc.Vec2.ZERO,this.timelineAutoPeek.kill(),this.isLockedRotation=!1,this.Container.active=!1,this.Container.active=!1,this.CornerContainer.active=!1,this.nodeBlur.active=!1,this.spriteFaceDrag.spriteFrame=null,this.spriteFaceDrag.enabled=!1,this.spriteBackCard.enabled=!1,this.NodeMaskCard.active=!1,this.mask.enabled=!0,this.setRotation(this.defaultAxis)},handleMouseDown:function(e){var t=null,i=e.getLocation();console.log(i);for(var n=0;n<this.ArrCorner.length&&null==(t=this.ArrCorner[n].GetCornerData(i,this.AxisDirection));n++);null!=t&&(this.setCornerData(t),this.register(),this.handleMouseMoved(e))},handleMouseUp:function(){this.unregister(),this.spriteBackCard.enabled=!0,this.CornerContainer.active=!0,this.nodeBlur.active=!1,this.NodeMaskCard.active=!1},handleMouseMoved:function(e){var t=e.getLocation();cc.Intersection.pointInPolygon(t,this.arrPointOfRectCancel)?this.handleMouseUp():this.handlePointerLocation(t)},setCornerData:function(e){this.NodeMaskCard.anchorX=e.MaskAnchor.x,this.NodeMaskCard.anchorY=e.MaskAnchor.y,this.NodeFaceCardDrag.anchorX=e.FaceAnchor.x,this.NodeFaceCardDrag.anchorY=e.FaceAnchor.y,this.NodeFaceCardDisplay.anchorX=e.FaceAnchor.x,this.NodeFaceCardDisplay.anchorY=e.FaceAnchor.y,this.horizontalAlign=e.HorizontalAlign,this.verticalAlign=e.VerticalAlign,this.vertexDragging=e.VertexDragging,this.arrPointOfRectPeeking=e.ArrPointOfRectPeeking,this.arrPointOfRectCancel=e.ArrPointOfRectCancel,this.angleCoefficient=this.horizontalAlign*this.verticalAlign*this.AxisDirection,this.angleFinger=180*Math.atan(this.NodeFaceCardDisplay.width/this.NodeFaceCardDisplay.width)/Math.PI,this.CornerContainer.active=!1,this.nodeBlur.active=!0,this.spriteBackCard.enabled=!1,this.NodeMaskCard.active=!0},handlePointerLocation:function(e){console.log(e.x,e.y),this.angleDragging=this.calcAngle(e,this.vertexDragging)*this.angleCoefficient,this.horizontalAlign!=n.HorizontalAlign.Center&&this.verticalAlign!=n.VerticalAlign.Center&&(this.angleDragging-=this.Container.angle),this.setFacePosition(e),this.setMaskPosition(e),this.setWorldPostion(this.NodeBackCardDisplay,this.getWorldPosition(this.NodeBackCardDrag)),this.NodeBackCardDisplay.angle=-this.NodeMaskCard.angle,this.setWorldPostion(this.NodeFaceCardDisplay,this.getWorldPosition(this.NodeFaceCardDrag)),this.NodeFaceCardDisplay.angle=this.NodeFaceCardDrag.angle-this.NodeMaskCard.angle,this.checkAvailableOpen(e)},setFacePosition:function(e){switch(this.setWorldPostion(this.NodeFaceCardDrag,e),this.horizontalAlign){case n.HorizontalAlign.Center:this.NodeFaceCardDrag.x=this.NodeBackCardDrag.x}switch(this.verticalAlign){case n.VerticalAlign.Center:this.NodeFaceCardDrag.y=this.NodeBackCardDrag.y}this.NodeFaceCardDrag.angle=2*this.angleDragging},setMaskPosition:function(e){var t=this.calcMidPoint(e,this.vertexDragging);this.setWorldPostion(this.NodeMaskCard,t),this.NodeMaskCard.angle=this.angleDragging},checkAvailableOpen:function(e){if(!cc.Intersection.pointInPolygon(e,this.arrPointOfRectPeeking)){this.unregister(),this.timelineAutoPeek.kill(),this.spriteFaceDrag.spriteFrame=this.spriteFace.spriteFrame,this.spriteFaceDrag.enabled=!0,this.NodeMaskCard.active=!1,this.CornerContainer.active=!1,this.nodeBlur.active=!1;var t=0,i=1,n=Math.abs(180-this.NodeFaceCardDrag.angle),r=Math.abs(this.NodeFaceCardDrag.angle),a=Math.abs(-180-this.NodeFaceCardDrag.angle);switch(Math.min(n,r,a)){case n:i=-1,t=180;break;case a:i=-1,t=-180;break;default:i=1,t=0}var o=new TimelineMax({onComplete:this.showDisplayCard.bind(this)}),s=i*this.NodeFaceCardDrag.width*(this.NodeFaceCardDrag.anchorX-.5),c=i*this.NodeFaceCardDrag.height*(this.NodeFaceCardDrag.anchorY-.5);o.addLabel("FLIP"),o.add(TweenMax.to(this.NodeFaceCardDrag,.15,{scale:1.1,repeat:1,yoyo:!0}),"FLIP"),o.add(TweenMax.to(this.NodeFaceCardDrag,.3,{angle:t,x:s,y:c}),"FLIP")}},rotateContent:function(){if(!this.isLockedRotation){var e=null;switch(this.AxisDirection){case n.AxisDirection.Horizontal:e=n.AxisDirection.Vertical;break;case n.AxisDirection.Vertical:e=n.AxisDirection.Horizontal}this.setRotation(e)}},setRotation:function(e){switch(this.AxisDirection=e,this.AxisDirection){case n.AxisDirection.Horizontal:this.Container.angle=90;break;case n.AxisDirection.Vertical:this.Container.angle=0}},calcMidPoint:function(e,t){var i=new cc.Vec2;return i.x=(e.x+t.x)/2,i.y=(e.y+t.y)/2,i},calcAngle:function(e,t){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=Math.abs(e.x-t.x)/i;return 90-(90-180*Math.acos(n)/Math.PI)},getWorldPosition:function(e){return null==e.parent?e.position:e.parent.convertToWorldSpaceAR(e.position)},setWorldPostion:function(e,t){null==e.parent&&(e.position=t),e.position=e.parent.convertToNodeSpaceAR(t)}}),cc._RF.pop()},{"card-provider":"card-provider","corner-peeking":"corner-peeking","peek-card-enums":"peek-card-enums"}],"peek-card-enums":[function(e,t){"use strict";cc._RF.push(t,"162c8kTBjdMvoDJk9pjFRur","peek-card-enums");var i=cc.Enum({Horizontal:-1,Vertical:1}),n=cc.Enum({Left:-1,Center:0,Right:1}),r=cc.Enum({Bottom:-1,Center:0,Top:1});t.exports={PeekCardID:{PeekCard:"PeekCard",PeekCardSuccess:"PeekCardSuccess",PeekCardHideComplete:"PeekCardHideComplete",PeekCardCountDown:"PeekCardCountDown",PeekCardTimeOut:"PeekCardTimeOut",PeekCardNotifyTimeOut:"PeekCardNotifyTimeOut"},AxisDirection:i,HorizontalAlign:n,VerticalAlign:r},cc._RF.pop()},{}],"test-peek-card":[function(e,t){"use strict";cc._RF.push(t,"91548RpLc5AFqVk6EusiDsN","test-peek-card"),cc.Class({extends:cc.Component,properties:{peekCard:e("peek-card-content"),btnReset:cc.Button},start:function(){this.btnReset.node.on("click",this.onBtnResetClick,this)},onBtnResetClick:function(){this.peekCard.OpenPeekCard(cc.math.randomRangeInt(0,53))},onBtnAutoClick:function(){this.peekCard.DisablePeekCard()}}),cc._RF.pop()},{"peek-card-content":"peek-card-content"}]},{},["cc-enum","card-provider","corner-peeking","peek-card-content","peek-card-enums","test-peek-card"]);